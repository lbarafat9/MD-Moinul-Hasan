<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Nokol Nobish Pro v15.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- PREMIUM DARK THEME --- */
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --accent: #06b6d4;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #172554 100%);
            --sidebar-bg: rgba(15, 23, 42, 0.98);
            --text-main: #f8fafc;
            --text-light: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --office: #8b5cf6;
            --font-main: 'Hind Siliguri', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: var(--font-main); background: var(--bg-gradient); color: var(--text-main); min-height: 100vh; background-attachment: fixed; overflow-x: hidden; }

        /* --- TOAST --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { min-width: 280px; margin-bottom: 12px; background: #1e293b; color: #fff; padding: 15px 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: space-between; animation: slideIn 0.3s ease-out forwards; border-left: 6px solid var(--primary); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- LOGIN SCREEN --- */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #111827 0%, #1e1b4b 100%); display: flex; align-items: center; justify-content: center; z-index: 9000; }
        .login-card { background: #1f2937; width: 90%; max-width: 360px; padding: 35px 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; border: 1px solid #374151; }
        .login-card h2 { font-size: 26px; color: var(--primary); margin-bottom: 5px; }
        .login-input { width: 100%; padding: 12px 15px; border: 1px solid #4b5563; border-radius: 10px; font-size: 14px; background: #374151; color: #fff; margin-bottom: 15px; }
        .login-btn { width: 100%; padding: 12px; background: var(--success); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .reset-link { font-size: 12px; color: var(--accent); cursor: pointer; margin-top: 15px; display: block; text-decoration: underline; }

        /* --- HEADER --- */
        header { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); padding: 0 20px; height: 70px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; width: 100%; z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .menu-btn { font-size: 24px; color: #fff; cursor: pointer; padding: 10px; }
        .headline { text-align: center; flex-grow: 1; }
        .office-name { font-size: 16px; font-weight: 700; color: #fff; display: block; }
        .user-status { font-size: 11px; color: var(--text-light); display: flex; align-items: center; justify-content: center; gap: 5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .status-dot.online { background: var(--success); box-shadow: 0 0 8px var(--success); }

        /* --- SIDEBAR --- */
        #sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: var(--sidebar-bg); border-right: 1px solid rgba(255,255,255,0.1); z-index: 2000; display: flex; flex-direction: column; transition: 0.3s ease; }
        #sidebar.active { left: 0; }
        .sidebar-header { padding: 25px 20px; background: linear-gradient(to right, var(--primary), var(--accent)); color: #fff; text-align: center; }
        #sidebar a { display: block; color: #94a3b8; text-decoration: none; padding: 12px 25px; cursor: pointer; transition: 0.3s; border-left: 4px solid transparent; font-size: 14px; }
        #sidebar a i { margin-right: 10px; width: 20px; }
        #sidebar a:hover, #sidebar a.active { background: rgba(255,255,255,0.05); color: #fff; border-left-color: var(--accent); }
        .sidebar-footer { margin-top: auto; padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 11px; color: var(--text-light); text-align: center; }
        .dev-credit { color: var(--accent); font-weight: bold; margin-top: 5px; display: block; font-size: 13px; }

        /* --- PROFILE BUTTON --- */
        #profileBtn { background: var(--primary); color: #fff; padding: 6px 12px; border-radius: 30px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 12px; }
        #profileMenu { position: absolute; top: 65px; right: 20px; width: 200px; background: #1f2937; border-radius: 12px; display: none; box-shadow: 0 15px 40px rgba(0,0,0,0.5); border: 1px solid #374151; overflow: hidden; z-index: 2000; }
        .p-item { padding: 12px 20px; border-bottom: 1px solid #374151; cursor: pointer; color: #e2e8f0; font-size: 14px; }
        .p-item:hover { background: #374151; color: var(--accent); }

        /* --- CONTENT --- */
        #container { padding: 100px 20px 30px 20px; width: 100%; transition: 0.3s; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .card { background: #1e293b; padding: 20px; border-radius: 16px; text-align: center; border: 1px solid #334155; border-bottom: 4px solid var(--primary); cursor: pointer; transition: 0.3s; }
        .card b { font-size: 22px; display: block; margin-top: 8px; color: #fff; }
        .card span { font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: bold; }

        /* --- CLIENT CARD --- */
        .client-card { background: #1e293b; border: 1px solid #334155; border-radius: 15px; padding: 18px; margin-bottom: 15px; border-left: 6px solid var(--primary); position: relative; }
        .status-tag { position: absolute; top: 15px; right: 15px; font-size: 10px; padding: 3px 8px; border-radius: 20px; font-weight: bold; text-transform: uppercase; z-index: 5; }
        .tag-pending { background: #374151; color: #94a3b8; }
        .tag-processing { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .tag-ready { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .tag-delivered { background: rgba(79, 70, 229, 0.2); color: var(--primary); }

        .dalil-badge { display: inline-block; background: rgba(6, 182, 212, 0.15); color: var(--accent); padding: 2px 8px; border-radius: 6px; font-size: 13px; font-weight: bold; margin-top: 5px; border: 1px solid rgba(6, 182, 212, 0.3); }
        .payment-info { display: flex; justify-content: space-between; background: #0f172a; padding: 12px; border-radius: 10px; margin-top: 10px; font-size: 14px; font-weight: bold; }

        /* --- MODALS --- */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 550px; max-width: 95%; background: #1e293b; padding: 30px; border-radius: 20px; z-index: 3000; border: 1px solid #475569; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 1500; }

        /* --- TABS --- */
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px; overflow-x: auto; }
        .tab-btn { background: #0f172a; color: #94a3b8; border: 1px solid #334155; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 13px; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        /* --- INPUTS --- */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 13px; color: #94a3b8; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #475569; background: #0f172a; color: #fff; }
        .bill-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }

        .fab { position: fixed; bottom: 30px; right: 30px; background: var(--primary); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.3); cursor: pointer; z-index: 1000; }

        .section { display: none; }
        .section.active { display: block; }

        .table-box { background: #1e293b; border-radius: 16px; border: 1px solid #334155; overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #334155; font-size: 13px; }
        th { background: #0f172a; color: #94a3b8; }

        .action-btn { background: none; border: none; cursor: pointer; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: bold; color: #fff; }
        .btn-view { color: var(--accent); border: 1px solid var(--accent); }
        .btn-edit { background: var(--warning); color: #000; }
        .btn-delete { background: var(--danger); }
        .btn-sms { background: #38bdf8; }
        .btn-call { background: var(--primary); text-decoration: none; display: inline-block; }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    <div id="overlay" onclick="closeAll()"></div>

    <!-- ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® -->
    <div id="loginScreen">
        <div class="login-card">
            <h2>‡¶®‡¶ï‡¶≤ ‡¶®‡¶¨‡ßÄ‡¶∂ <span>PRO</span></h2>
            <p style="color: #94a3b8; font-size: 12px; margin-bottom: 20px;">v15.0 Security Login</p>
            <input type="email" id="uEmail" class="login-input" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
            <input type="password" id="uPass" class="login-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <button class="login-btn" onclick="login()">‚ûú ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <span class="reset-link" onclick="resetPassword()">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</span>
        </div>
    </div>

    <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ -->
    <div id="mainApp" style="display:none;">
        <!-- ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ -->
        <div id="sidebar">
            <div class="sidebar-header">
                <h3 id="sideUserName">‡¶Æ‡ßã‡¶É ‡¶Æ‡¶à‡¶®‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®</h3>
                <p id="sideOfficeName">‡¶∏‡¶æ‡¶¨-‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßü, ‡¶ï‡¶æ‡¶∂‡¶ø‡ßü‡¶æ‡¶®‡ßÄ</p>
            </div>

            <a onclick="showSection('dashboard')" id="nav-dashboard" class="active"><i class="fas fa-home"></i> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a>
            <a onclick="showSection('pending')" id="nav-pending"><i class="fas fa-spinner"></i> ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶ú</a>
            <a onclick="showSection('ready')" id="nav-ready"><i class="fas fa-check-circle"></i> ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø</a>
            <a onclick="showSection('due')" id="nav-due"><i class="fas fa-hand-holding-usd"></i> ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</a>
            <a onclick="showSection('customerList')" id="nav-customerList"><i class="fas fa-address-book"></i> ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</a>
            <a onclick="showSection('clients')" id="nav-clients"><i class="fas fa-users"></i> ‡¶∏‡¶¨ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</a>
            <a onclick="showSection('office')" id="nav-office"><i class="fas fa-building"></i> ‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</a>
            <a onclick="showSection('expenses')" id="nav-expenses"><i class="fas fa-calculator"></i> ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§‡¶æ</a>
            <a onclick="showSection('reports')" id="nav-reports"><i class="fas fa-chart-bar"></i> ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ì ‡¶è‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏</a>

            <div class="sidebar-footer">
                <p>‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: <span id="sideStatus" style="color:var(--success)">‚óè ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®</span></p>
                <span class="dev-credit">‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞: ‡¶Ü‡¶∞‡¶æ‡¶´‡¶æ‡¶§ ‡¶∏‡¶ø‡¶ï‡¶¶‡¶æ‡¶∞</span>
                <p>v15.0 | Smart Nokol Nobish</p>
            </div>
        </div>

        <header>
            <div class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
            <div class="headline">
                <span class="office-name" id="headerOfficeName">‡¶∏‡¶æ‡¶¨-‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßü</span>
                <span class="user-status">
                    <span id="headerUserName">‡¶Æ‡ßã‡¶É ‡¶Æ‡¶à‡¶®‡ßÅ‡¶≤ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®</span>
                    <span id="connStatus" class="status-dot"></span>
                </span>
            </div>
            <div id="profileBtn" onclick="toggleProfile()">
                <i class="fas fa-user-circle"></i> <span id="pName">User</span>
            </div>
            <div id="profileMenu">
                <div class="p-item" onclick="showSection('profile')">üë§ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
                <div class="p-item" onclick="openModal('settingsModal')">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
                <div class="p-item" onclick="logout()" style="color: var(--danger);">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</div>
            </div>
        </header>

        <div id="container">
            <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="card" style="border-bottom-color: var(--success);" onclick="showSection('dashboard')">
                        <span>‡¶®‡¶ó‡¶¶ ‡¶§‡¶π‡¶¨‡¶ø‡¶≤</span>
                        <b id="cashInHand">0 ‡ß≥</b>
                    </div>
                    <div class="card" style="border-bottom-color: var(--danger);" onclick="showSection('due')">
                        <span>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</span>
                        <b id="totalCustomerDue">0 ‡ß≥</b>
                    </div>
                    <div class="card" style="border-bottom-color: var(--office);" onclick="showSection('office')">
                        <span>‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶™‡¶æ‡¶ì‡¶®‡¶æ</span>
                        <b id="totalOfficeDue">0 ‡ß≥</b>
                    </div>
                    <div class="card" style="border-bottom-color: var(--warning);" onclick="showSection('pending')">
                        <span>‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶ú</span>
                        <b id="totalPending">0</b>
                    </div>
                </div>
                <h3 style="margin-bottom: 15px; color: var(--accent);"><i class="fas fa-history"></i> ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú (‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡ß´‡ß¶‡¶ü‡¶ø)</h3>
                <div id="dashboardTaskList"></div>
            </div>

            <!-- ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
            <div id="customerList" class="section">
                <h3 style="margin-bottom: 20px; color: var(--accent);">üë• ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <div class="table-box">
                    <table>
                        <thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶¶‡¶≤‡¶ø‡¶≤ ‡¶®‡¶Ç</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th><th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤</th><th>‡¶¨‡¶ï‡ßá‡ßü‡¶æ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead>
                        <tbody id="customerTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π -->
            <div id="pending" class="section"><h3 style="margin-bottom:20px; color:var(--warning);">‚è≥ ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3><div id="pendingList"></div></div>
            <div id="ready" class="section"><h3 style="margin-bottom:20px; color:var(--success);">‚úÖ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú</h3><div id="readyList"></div></div>
            <div id="due" class="section"><h3 style="margin-bottom:20px; color:var(--danger);">üí∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3><div id="dueList"></div></div>
            <div id="clients" class="section"><input type="text" id="searchInput" placeholder="üîç ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="renderAllLists()" style="margin-bottom:20px;"><div id="allClientsList"></div></div>
            <div id="office" class="section"><div class="card" style="max-width: 500px; margin: auto; padding: 40px; cursor: default;"><span>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ</span><b id="officeViewDue" style="font-size: 45px; color: var(--office); margin: 20px 0;">0 ‡ß≥</b><button class="btn-save" style="background: var(--office);" onclick="openOfficePayModal()">‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>
            <div id="expenses" class="section"><div class="table-box" style="padding: 20px; max-width: 500px; margin: auto; margin-bottom: 30px;"><div class="form-group"><input type="text" id="exDesc" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£"></div><div class="form-group"><input type="number" id="exAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ"></div><button class="btn-save" onclick="addExpense()">‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div><div id="expenseList"></div></div>
            <div id="reports" class="section"><h3 style="margin-bottom: 20px; color: var(--accent);">üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ì ‡¶è‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏</h3><div class="client-card" style="border-left-color: var(--accent);"><div class="bill-grid"><div class="form-group"><label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="reportStartDate"></div><div class="form-group"><label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="reportEndDate"></div></div><button class="btn-save" onclick="generateDateReport()">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button></div><div id="reportResult" style="display:none; margin-top:20px;"><div class="stats-grid"><div class="card" style="border-bottom-color: var(--success);"><span>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ</span><b id="repTotalIncome">0 ‡ß≥</b></div><div class="card" style="border-bottom-color: var(--danger);"><span>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö</span><b id="repTotalExpense">0 ‡ß≥</b></div></div><div id="reportDetailsList"></div></div></div>
            <div id="profile" class="section"><div class="card" style="max-width: 450px; margin: auto;"><i class="fas fa-user-shield" style="font-size: 60px; color: var(--primary);"></i><h2 id="profName" style="margin-top: 15px;">‡¶®‡¶æ‡¶Æ</h2><p id="profOffice" style="color: var(--text-light);">‡¶Ö‡¶´‡¶ø‡¶∏</p><button class="btn-save" style="background:var(--warning); color:#000; margin-top:20px;" onclick="resetPassword()">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button></div></div>
        </div>

        <div class="fab" onclick="openModal('entryModal')"><i class="fas fa-plus"></i></div>

        <!-- ‡¶Æ‡¶°‡¶æ‡¶≤‡¶∏‡¶Æ‡ßÇ‡¶π -->
        <div class="modal" id="entryModal">
            <h3 id="modalTitle" style="color: var(--accent); margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
            <input type="hidden" id="editClientId">
            <div class="form-group"><label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="cName" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div>
            <div class="bill-grid"><div class="form-group"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input type="tel" id="cMobile" maxlength="11"></div><div class="form-group"><label>‡¶¶‡¶≤‡¶ø‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="text" id="cDalil"></div></div>
            <div class="form-group"><label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="cDate"></div>
            <p style="font-size:12px; font-weight:bold; color:var(--primary); margin-bottom:10px;">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶≤ (‡¶ü‡¶æ‡¶ï‡¶æ):</p>
            <div class="bill-grid"><div class="form-group"><label>‡¶®‡¶ï‡¶≤ ‡¶´‡¶ø</label><input type="number" id="feeNokol" value="0" oninput="calcTotal()"></div><div class="form-group"><label>‡¶§‡¶≤‡ßç‡¶≤‡¶æ‡¶∂</label><input type="number" id="feeTollash" value="0" oninput="calcTotal()"></div></div>
            <p style="font-size:12px; font-weight:bold; color:var(--office); margin-bottom:10px;">‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶™‡¶æ‡¶ì‡¶®‡¶æ (‡¶ü‡¶æ‡¶ï‡¶æ):</p>
            <div class="bill-grid" style="background: rgba(139, 92, 246, 0.1); padding: 10px; border-radius: 10px;">
                <div class="form-group"><label>‡¶á‡¶®‡ßç‡¶°‡ßã‡¶∏‡¶Æ‡ßá‡¶®‡ßç‡¶ü</label><input type="number" id="feeEndorse" value="0" oninput="calcTotal()"></div>
                <div class="form-group"><label>‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶´‡¶ø</label><input type="number" id="feeComputer" value="0" oninput="calcTotal()"></div>
                <div class="form-group"><label>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</label><input type="number" id="feeOfficeOther" value="0" oninput="calcTotal()"></div>
                <div class="form-group"><label>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶´‡¶ø‡¶∏</label><div id="cOfficeDisplay" style="font-weight:bold; color:var(--office); padding:10px 0;">0</div></div>
            </div>
            <div style="background: var(--primary); color: #fff; padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center;">‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶≤: ‡ß≥ <span id="cTotalDisplay" style="font-size: 24px; font-weight: 800;">0</span></div>
            <div class="bill-grid"><div class="form-group"><label>‡¶ú‡¶Æ‡¶æ (‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ)</label><input type="number" id="cAdvance" value="0" oninput="calcTotal()"></div><div class="form-group"><label>‡¶¨‡¶ï‡ßá‡ßü‡¶æ</label><div id="cDueDisplay" style="color: var(--danger); font-weight:bold; padding:12px 0; font-size:18px;">0</div></div></div>
            <button class="btn-save" id="saveBtn" onclick="saveClient()">üíæ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="closeAll()" style="background:none; color:var(--text-light); border:none; width:100%; margin-top:10px; cursor:pointer;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>

        <div class="modal" id="viewDetailsModal">
            <h3 style="color: var(--accent); margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px;">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
            <div id="detailsContent" style="font-size: 14px; line-height: 1.8;"></div>
            <button onclick="closeAll()" style="background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; margin-top: 20px; font-weight: bold; cursor: pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="modal" id="expenseEditModal">
            <h3 style="color: var(--danger); margin-bottom: 20px;">‡¶ñ‡¶∞‡¶ö ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®</h3>
            <input type="hidden" id="editExpenseId">
            <div class="form-group"><label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label><input type="text" id="editExDesc"></div>
            <div class="form-group"><label>‡¶ü‡¶æ‡¶ï‡¶æ</label><input type="number" id="editExAmount"></div>
            <button class="btn-save" style="background: var(--danger);" onclick="updateExpense()">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="closeAll()" style="background:none; color:var(--text-light); border:none; width:100%; margin-top:10px; cursor:pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="modal" id="settingsModal">
            <h3 style="color: var(--accent); margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px;">‚öôÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
            <div class="tab-menu"><button class="tab-btn active" onclick="switchTab('general')">General</button><button class="tab-btn" onclick="switchTab('security')">Security</button><button class="tab-btn" onclick="switchTab('database')" style="color:var(--danger)">Database</button></div>
            <div id="tab-general" class="tab-content"><div class="form-group"><label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setUserName"></div><div class="form-group"><label>‡¶Ö‡¶´‡¶ø‡¶∏‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setOfficeName"></div><div class="form-group"><label>‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞</label><input type="color" id="setThemeColor" style="height:50px;"></div><button class="btn-save" onclick="saveSettings()">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            <div id="tab-security" class="tab-content" style="display:none;"><div class="form-group"><label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="oldPassword" placeholder="Old Password"></div><div class="form-group"><label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="newPassword" placeholder="‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü"></div><button class="btn-save" style="background:var(--warning); color:#000;" onclick="changePassword()">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            <div id="tab-database" class="tab-content" style="display:none;"><button class="btn-save" style="background:var(--success);" onclick="downloadBackup()">üì• ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ (JSON)</button><button class="btn-save" style="background:var(--danger); margin-top:20px;" onclick="factoryReset()">üî• ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button></div>
            <button onclick="closeAll()" style="background:none; color:var(--text-light); border:none; width:100%; margin-top:15px; cursor:pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="modal" id="officePayModal"><h3 style="color: var(--office);">‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶¨‡¶ø‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡¶£</h3><p>‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶ì‡¶®‡¶æ: <span id="modalOfficeDue" style="font-weight:bold;">0</span> ‡ß≥</p><div class="form-group"><label>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="officeReceivedAmount"></div><button class="btn-save" style="background: var(--office);" onclick="submitOfficePayment()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button><button onclick="closeAll()" style="background:none; color:var(--text-light); border:none; width:100%; margin-top:10px; cursor:pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
    </div>

    <!-- FIREBASE LIBRARIES -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCzq8ATdWjw4Ut65bEGVL08oS9SU-5I8Pk",
            authDomain: "md-moinul-hasan.firebaseapp.com",
            databaseURL: "https://md-moinul-hasan-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "md-moinul-hasan",
            storageBucket: "md-moinul-hasan.firebasestorage.app",
            messagingSenderId: "158273523711",
            appId: "1:158273523711:web:bf90523fbf578bfb9121ca"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let clients = [];
        let expenses = [];
        let officeTransactions = [];

        // --- Auth ---
        function login() {
            const email = document.getElementById("uEmail").value;
            const pass = document.getElementById("uPass").value;
            if(!email || !pass) return showToast("‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®", "danger");
            auth.signInWithEmailAndPassword(email, pass).catch(err => showToast("‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!", "danger"));
        }
        function logout() { auth.signOut().then(() => location.reload()); }
        function resetPassword() {
            const email = document.getElementById("uEmail").value || auth.currentUser?.email;
            if(!email) return showToast("‡¶Ü‡¶ó‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "danger");
            auth.sendPasswordResetEmail(email).then(() => alert("‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"));
        }
        function changePassword() {
            const user = auth.currentUser;
            const oldPass = document.getElementById("oldPassword").value;
            const newPass = document.getElementById("newPassword").value;
            if(!oldPass || newPass.length < 6) return showToast("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¶‡¶ø‡¶®", "danger");
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, oldPass);
            user.reauthenticateWithCredential(credential).then(() => {
                user.updatePassword(newPass).then(() => { showToast("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); closeAll(); });
            }).catch(err => showToast("‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!", "danger"));
        }

        auth.onAuthStateChanged(user => {
            if (user) { document.getElementById("loginScreen").style.display = "none"; document.getElementById("mainApp").style.display = "block"; initData(); }
            else { document.getElementById("loginScreen").style.display = "flex"; }
        });

        function initData() {
            db.ref("appSettings").on("value", snap => { if(snap.exists()) applySettings(snap.val()); });
            db.ref("clients").on("value", snap => {
                clients = snap.exists() ? Object.values(snap.val()).sort((a,b)=>b.id-a.id) : [];
                renderAllLists(); renderCustomerTable(); updateStats();
            });
            db.ref("expenses").on("value", snap => {
                expenses = snap.exists() ? Object.keys(snap.val()).map(key => ({ key, ...snap.val()[key] })).sort((a,b)=>b.id-a.id) : [];
                renderExpenses(); updateStats();
            });
            db.ref("officeTransactions").on("value", snap => { officeTransactions = snap.exists() ? Object.values(snap.val()) : []; updateStats(); });
            db.ref(".info/connected").on("value", snap => {
                const dot = document.getElementById("connStatus");
                if(snap.val()) dot.classList.add("online"); else dot.classList.remove("online");
            });
        }

        // --- Core Logic ---
        function calcTotal() {
            const getV = id => parseFloat(document.getElementById(id).value) || 0;
            const cTotal = getV('feeNokol') + getV('feeTollash');
            const oTotal = getV('feeEndorse') + getV('feeComputer') + getV('feeOfficeOther');
            const adv = getV('cAdvance');
            document.getElementById('cTotalDisplay').innerText = cTotal;
            document.getElementById('cOfficeDisplay').innerText = oTotal;
            document.getElementById('cDueDisplay').innerText = cTotal - adv;
        }

        function saveClient() {
            const name = document.getElementById("cName").value;
            if(!name) return alert("‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
            const id = document.getElementById("editClientId").value || Date.now();
            const data = {
                id, name, mobile: document.getElementById("cMobile").value, dalil: document.getElementById("cDalil").value,
                date: document.getElementById("cDate").value || new Date().toISOString().split('T')[0],
                feeNokol: parseFloat(document.getElementById('feeNokol').value)||0,
                feeTollash: parseFloat(document.getElementById('feeTollash').value)||0,
                feeEndorse: parseFloat(document.getElementById('feeEndorse').value)||0,
                feeComputer: parseFloat(document.getElementById('feeComputer').value)||0,
                feeOfficeOther: parseFloat(document.getElementById('feeOfficeOther').value)||0,
                custTotal: parseFloat(document.getElementById("cTotalDisplay").innerText),
                officeTotal: parseFloat(document.getElementById("cOfficeDisplay").innerText),
                advance: parseFloat(document.getElementById("cAdvance").value) || 0,
                status: 'Pending', isOfficePaid: false
            };
            data.due = data.custTotal - data.advance;
            db.ref("clients/" + id).update(data).then(() => { closeAll(); clearForm(); showToast("‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success"); });
        }

        function editClient(id) {
            const c = clients.find(x => x.id == id);
            if(!c) return;
            document.getElementById("modalTitle").innerText = "‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶®";
            document.getElementById("editClientId").value = c.id;
            document.getElementById("cName").value = c.name;
            document.getElementById("cMobile").value = c.mobile;
            document.getElementById("cDalil").value = c.dalil;
            document.getElementById("cDate").value = c.date;
            document.getElementById("feeNokol").value = c.feeNokol;
            document.getElementById("feeTollash").value = c.feeTollash;
            document.getElementById("feeEndorse").value = c.feeEndorse;
            document.getElementById("feeComputer").value = c.feeComputer;
            document.getElementById("feeOfficeOther").value = c.feeOfficeOther;
            document.getElementById("cAdvance").value = c.advance;
            calcTotal();
            openModal('entryModal');
        }

        function viewClientDetails(id) {
            const c = clients.find(x => x.id == id);
            if(!c) return;
            const content = `<p><b>‡¶®‡¶æ‡¶Æ:</b> ${c.name}</p><p><b>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</b> ${c.mobile || '‡¶®‡ßá‡¶á'}</p><p><b>‡¶¶‡¶≤‡¶ø‡¶≤ ‡¶®‡¶Ç:</b> ${c.dalil || '‡¶®‡ßá‡¶á'}</p><p><b>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</b> ${c.date}</p><hr style="margin:10px 0; border:0; border-top:1px solid #334155;"><p>‡¶®‡¶ï‡¶≤ ‡¶´‡¶ø: ${c.feeNokol} ‡ß≥</p><p>‡¶§‡¶≤‡ßç‡¶≤‡¶æ‡¶∂ ‡¶´‡¶ø: ${c.feeTollash} ‡ß≥</p><p>‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶´‡¶ø (‡¶Ö‡¶´‡¶ø‡¶∏): ${c.feeComputer} ‡ß≥</p><p>‡¶á‡¶®‡ßç‡¶°‡ßã‡¶∏‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡¶Ö‡¶´‡¶ø‡¶∏): ${c.feeEndorse} ‡ß≥</p><p>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø (‡¶Ö‡¶´‡¶ø‡¶∏): ${c.feeOfficeOther} ‡ß≥</p><hr style="margin:10px 0; border:0; border-top:1px solid #334155;"><p><b>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤:</b> ${c.custTotal} ‡ß≥</p><p><b>‡¶ú‡¶Æ‡¶æ:</b> ${c.advance} ‡ß≥</p><p style="color:var(--danger)"><b>‡¶¨‡¶ï‡ßá‡ßü‡¶æ:</b> ${c.due} ‡ß≥</p><p style="color:var(--office)"><b>‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶™‡¶æ‡¶ì‡¶®‡¶æ:</b> ${c.officeTotal} ‡ß≥</p>`;
            document.getElementById("detailsContent").innerHTML = content;
            openModal('viewDetailsModal');
        }

        // --- SMS Function ---
        function sendSMS(id) {
            const c = clients.find(x => x.id == id);
            if (!c || !c.mobile) return showToast("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶®‡ßá‡¶á!", "danger");
            const msg = `Apnar dolil (No: ${c.dalil || 'N/A'}) ready hoyeche. Bokeya ${c.due} Tk niye office e jogajog korun. - Md. Moinul Hasan`;
            // Using standard SMS URI
            window.open(`sms:${c.mobile}?body=${encodeURIComponent(msg)}`, '_self');
        }

        // --- UI Helpers ---
        function toggleSidebar() { document.getElementById("sidebar").classList.toggle("active"); document.getElementById("overlay").style.display = document.getElementById("sidebar").classList.contains("active") ? "block" : "none"; }
        function closeSidebar() { document.getElementById("sidebar").classList.remove("active"); document.getElementById("overlay").style.display = "none"; }

        function renderAllLists() {
            const q = document.getElementById("searchInput").value.toLowerCase();
            renderToDiv(clients.slice(0, 50), "dashboardTaskList", q);
            renderToDiv(clients.filter(c => c.status === 'Pending' || c.status === 'Processing'), "pendingList", q);
            renderToDiv(clients.filter(c => c.status === 'Ready'), "readyList", q);
            renderToDiv(clients.filter(c => c.due > 0), "dueList", q);
            renderToDiv(clients, "allClientsList", q);
        }

        function renderToDiv(data, divId, query) {
            const div = document.getElementById(divId);
            if(!div) return; div.innerHTML = "";
            const filtered = data.filter(c => c.name.toLowerCase().includes(query) || (c.dalil && c.dalil.includes(query)));
            filtered.forEach(c => {
                const statusClass = `tag-${c.status.toLowerCase()}`;
                div.innerHTML += `
                <div class="client-card">
                    <span class="status-tag ${statusClass}">${c.status}</span>
                    <div style="padding-right: 80px;"><b style="font-size: 16px; display: block;">${c.name}</b><div class="dalil-badge">‡¶¶‡¶≤‡¶ø‡¶≤ ‡¶®‡¶Ç: ${c.dalil || '‡¶®‡ßá‡¶á'}</div></div>
                    <div style="font-size:11px; color:var(--text-light); margin-top:8px;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${c.date}</div>
                    <div class="payment-info"><span>‡¶¨‡¶ø‡¶≤: ${c.custTotal}</span><span>‡¶ú‡¶Æ‡¶æ: ${c.advance}</span><span style="color:var(--danger)">‡¶¨‡¶æ‡¶ï‡¶ø: ${c.due}</span></div>
                    <div style="margin-top:12px; display:flex; gap:8px; flex-wrap: wrap;">
                        <select onchange="updateStatus(${c.id}, this.value)" style="width:auto; padding:5px; font-size:12px; background:#0f172a; border-radius:5px; color:white; border:1px solid #444;"><option value="Pending" ${c.status==='Pending'?'selected':''}>Pending</option><option value="Processing" ${c.status==='Processing'?'selected':''}>Processing</option><option value="Ready" ${c.status==='Ready'?'selected':''}>Ready</option><option value="Delivered" ${c.status==='Delivered'?'selected':''}>Delivered</option></select>
                        <button onclick="editClient(${c.id})" class="action-btn btn-edit">Edit</button>
                        <button onclick="sendSMS(${c.id})" class="action-btn btn-sms">SMS</button>
                        <a href="tel:${c.mobile}" class="action-btn btn-call">Call</a>
                        <button onclick="deleteClient(${c.id})" class="action-btn btn-delete"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            });
        }

        function renderCustomerTable() {
            const tbody = document.getElementById("customerTableBody");
            tbody.innerHTML = "";
            clients.forEach(c => {
                tbody.innerHTML += `<tr><td>${c.name}</td><td>${c.dalil || '-'}</td><td>${c.mobile || '-'}</td><td>${c.custTotal}</td><td style="color:var(--danger)">${c.due}</td><td><button onclick="viewClientDetails(${c.id})" class="action-btn btn-view" style="color:var(--accent); border:none;">View</button><button onclick="editClient(${c.id})" class="action-btn btn-edit" style="padding:4px 8px;">Edit</button><button onclick="sendSMS(${c.id})" class="action-btn btn-sms" style="padding:4px 8px;">SMS</button></td></tr>`;
            });
        }

        function renderExpenses() {
            const div = document.getElementById("expenseList"); div.innerHTML = "";
            expenses.forEach(e => {
                div.innerHTML += `<div class="client-card" style="padding:10px; border-left-color:var(--danger); display:flex; justify-content:space-between; align-items:center;"><div><span>${e.desc} (${e.date})</span><br><b style="color:var(--danger)">-${e.amount} ‡ß≥</b></div><div><button onclick="editExpense('${e.key}')" class="action-btn btn-edit" style="padding:4px 8px;">Edit</button><button onclick="deleteExpense('${e.key}')" class="action-btn btn-delete" style="padding:4px 8px;"><i class="fas fa-trash"></i></button></div></div>`;
            });
        }

        function addExpense() {
            const desc = document.getElementById("exDesc").value; const amt = document.getElementById("exAmount").value;
            if(!desc || !amt) return; const id = Date.now();
            db.ref(`expenses/${id}`).set({ id, desc, amount: parseFloat(amt), date: new Date().toLocaleDateString("en-GB") });
            document.getElementById("exDesc").value = ""; document.getElementById("exAmount").value = "";
        }

        function editExpense(key) {
            const e = expenses.find(x => x.key === key);
            if(!e) return;
            document.getElementById("editExpenseId").value = e.key;
            document.getElementById("editExDesc").value = e.desc;
            document.getElementById("editExAmount").value = e.amount;
            openModal('expenseEditModal');
        }

        function updateExpense() {
            const key = document.getElementById("editExpenseId").value;
            const data = { desc: document.getElementById("editExDesc").value, amount: parseFloat(document.getElementById("editExAmount").value) };
            db.ref(`expenses/${key}`).update(data).then(() => { closeAll(); showToast("‡¶ñ‡¶∞‡¶ö ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); });
        }

        function deleteExpense(key) {
            if(confirm("‡¶ñ‡¶∞‡¶ö‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?")) {
                db.ref(`expenses/${key}`).remove().then(() => { showToast("‡¶ñ‡¶∞‡¶ö ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); });
            }
        }

        function updateStats() {
            const tExp = expenses.reduce((s, e) => s + (parseFloat(e.amount)||0), 0);
            const cColl = clients.reduce((s, c) => s + (parseFloat(c.advance)||0), 0);
            const oColl = officeTransactions.reduce((s, t) => s + (parseFloat(t.amount)||0), 0);
            const oDue = clients.reduce((s, c) => (!c.isOfficePaid ? s + (parseFloat(c.officeTotal)||0) : s), 0);
            document.getElementById('cashInHand').innerText = (cColl + oColl - tExp) + " ‡ß≥";
            document.getElementById('totalCustomerDue').innerText = clients.reduce((s, c) => s + c.due, 0) + " ‡ß≥";
            document.getElementById('totalOfficeDue').innerText = oDue + " ‡ß≥";
            document.getElementById('officeViewDue').innerText = oDue + " ‡ß≥";
            document.getElementById('totalPending').innerText = clients.filter(c => c.status === 'Pending' || c.status === 'Processing').length;
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('#sidebar a').forEach(a => a.classList.remove('active'));
            const nav = document.getElementById('nav-' + id); if(nav) nav.classList.add('active');
            closeSidebar(); closeProfile();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).style.display = 'block'; event.currentTarget.classList.add('active');
        }

        function applySettings(s) {
            document.documentElement.style.setProperty('--primary', s.themeColor || '#4f46e5');
            document.getElementById("headerOfficeName").innerText = s.officeName;
            document.getElementById("headerUserName").innerText = s.userName;
            document.getElementById("sideUserName").innerText = s.userName;
            document.getElementById("sideOfficeName").innerText = s.officeName;
            document.getElementById("pName").innerText = s.userName;
            document.getElementById("profName").innerText = s.userName;
            document.getElementById("profOffice").innerText = s.officeName;
            document.getElementById("setUserName").value = s.userName;
            document.getElementById("setOfficeName").value = s.officeName;
            document.getElementById("setThemeColor").value = s.themeColor;
        }

        function saveSettings() {
            const data = { userName: document.getElementById("setUserName").value, officeName: document.getElementById("setOfficeName").value, themeColor: document.getElementById("setThemeColor").value };
            db.ref("appSettings").set(data).then(() => { showToast("‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success"); closeAll(); });
        }

        function toggleProfile() { const menu = document.getElementById("profileMenu"); menu.style.display = menu.style.display === "block" ? "none" : "block"; }
        function closeProfile() { document.getElementById("profileMenu").style.display = "none"; }
        function openModal(id) { document.getElementById(id).style.display = "block"; document.getElementById("overlay").style.display = "block"; }
        function closeAll() { document.querySelectorAll('.modal').forEach(m => m.style.display = "none"); document.getElementById("overlay").style.display = "none"; closeProfile(); closeSidebar(); }
        function showToast(msg, type) {
            const container = document.getElementById("toast-container");
            const toast = document.createElement("div"); toast.className = "toast";
            toast.style.borderLeftColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
            toast.innerHTML = `<span>${msg}</span>`; container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        function clearForm() {
            ['cName','cMobile','cDalil','feeNokol','feeTollash','feeEndorse','feeComputer','feeOfficeOther','cAdvance','editClientId'].forEach(i => document.getElementById(i).value = "");
            ['feeNokol','feeTollash','feeEndorse','feeComputer','feeOfficeOther','cAdvance'].forEach(i => document.getElementById(i).value = "0");
            document.getElementById("modalTitle").innerText = "‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø";
            calcTotal();
        }
        function updateStatus(id, st) { db.ref("clients/" + id).update({ status: st }); }
        function deleteClient(id) { if(confirm("‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) db.ref("clients/" + id).remove(); }
        function openOfficePayModal() {
            const due = clients.reduce((s, c) => (!c.isOfficePaid ? s + (parseFloat(c.officeTotal)||0) : s), 0);
            document.getElementById('modalOfficeDue').innerText = due;
            document.getElementById('officeReceivedAmount').value = due;
            openModal('officePayModal');
        }
        function submitOfficePayment() {
            const amt = parseFloat(document.getElementById('officeReceivedAmount').value);
            if(amt <= 0) return;
            db.ref('officeTransactions').push({ date: new Date().toISOString(), amount: amt });
            clients.forEach(c => { if(!c.isOfficePaid) db.ref(`clients/${c.id}`).update({ isOfficePaid: true }); });
            closeAll();
        }
        function downloadBackup() {
            const backupData = { clients, expenses, officeTransactions, timestamp: new Date().toISOString() };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backupData));
            const downloadAnchorNode = document.createElement('a'); downloadAnchorNode.setAttribute("href", dataStr); downloadAnchorNode.setAttribute("download", "nokol_nobish_backup.json");
            document.body.appendChild(downloadAnchorNode); downloadAnchorNode.click(); downloadAnchorNode.remove();
        }
        function factoryReset() { if(confirm("‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®?")) { db.ref('/').remove().then(() => location.reload()); } }
        function generateDateReport() {
            const start = document.getElementById('reportStartDate').value;
            const end = document.getElementById('reportEndDate').value;
            if(!start || !end) return showToast("‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", "danger");
            let totalInc = 0; let totalExp = 0;
            const listDiv = document.getElementById('reportDetailsList'); listDiv.innerHTML = "";
            clients.forEach(c => { if(c.date >= start && c.date <= end) { totalInc += c.advance; listDiv.innerHTML += `<div class="client-card" style="padding:10px; font-size:12px;">${c.date} | ${c.name} | ‡¶ú‡¶Æ‡¶æ: ${c.advance} ‡ß≥</div>`; } });
            expenses.forEach(e => { const parts = e.date.split('/'); const eDate = `${parts[2]}-${parts[1]}-${parts[0]}`; if(eDate >= start && eDate <= end) { totalExp += e.amount; listDiv.innerHTML += `<div class="client-card" style="padding:10px; font-size:12px; border-left-color:var(--danger);">${e.date} | ${e.desc} | ‡¶ñ‡¶∞‡¶ö: ${e.amount} ‡ß≥</div>`; } });
            document.getElementById('repTotalIncome').innerText = totalInc + " ‡ß≥"; document.getElementById('repTotalExpense').innerText = totalExp + " ‡ß≥";
            document.getElementById('reportResult').style.display = "block";
        }
    </script>
</body>
</html>
